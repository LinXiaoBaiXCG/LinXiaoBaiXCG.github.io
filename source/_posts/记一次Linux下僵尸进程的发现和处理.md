---
title: 记一次Linux下僵尸进程的发现和处理
date: 2021-07-15 20:00:00
tags: [DevOps]
categories: 编程
---

# 问题描述

公司测试服务器收到阿里云的通知，告知YApi管理平台任意命令执行漏洞。具体如下：

~~~
近日，阿里云应急响应中心监测到互联网上披露YApi管理平台任意命令执行漏洞。黑客通过该漏洞可入侵服务器、传播蠕虫病毒或获取服务器上的机密数据。经阿里云工程师紧急排查，您的服务器: http://x.x.x.x:3000/ 疑似受漏洞影响，建议您尽快使用阿里云云安全中心应急漏洞模块进行一键检测。参考：http://p.tb.cn/2jiVj6
~~~

参考建议进行处理后，还是不幸中招。首先是服务器端口被阿里云封禁，显示服务器对外发起了攻击。然后，测试人员发现服务器响应缓慢，服务器上Redis连接异常。最终发现是僵尸进程占用了网络带宽，需及时清理。

# 问题原因

黑客通过漏洞入侵服务器，接着病毒通过服务器对外发起了攻击，导致带宽被占用。

# 解决问题

1. 执行top命令查看服务器状态，查看后显示服务器内存正常，但是CPU使用率会飙到100%，同时也发现了一个异常的进程。
2. 接着在阿里云控制台发现随着CPU使用率的上升，带宽输出也随着上升。
3. 通过实时流量监控工具iftop查看服务器流量。操作如下：

* 安装iftop

~~~shell
yum install iftop -y
~~~

* 运行命令查看流量占用情况

~~~
iftop -i eth0 -P # 显示出主机名和端口号
~~~

最终发现一个陌生的端口号占用了大量输出带宽

4. 通过`sudo netstat -antup`查看当前系统下所运行的所有端口情况，发现这个陌生的端口号的Program name同1发现的异常进程一样。
5. 通过以上推断就是这个异常进程导致服务器异常。但是通过`kill -9`杀掉进程后发现还是会自动重启。
6. 僵尸进程的处理：

* 找到PPID（父进程）

~~~sh
cat /proc/进程ID
~~~

* 杀死僵尸进程

使用`Kill -HUP`僵尸进程ID来杀死僵尸进程，往往此种情况无法杀死僵尸进程，此时就需要杀死僵尸进程的父进程`kill -HUP`僵尸进程父ID